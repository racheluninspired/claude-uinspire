<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U INSPIRE Wall - Drop #003</title>
    <link href="https://fonts.googleapis.com/css2?family=Koulen:wght@400&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f7f5f0;
            color: #111;
            overflow-x: hidden;
        }

        /* DROP COUNTDOWN SECTION */
        .countdown-section {
            background: linear-gradient(135deg, #111 0%, #222 100%);
            color: white;
            padding: 24px 20px;
            text-align: center;
            position: relative;
        }

        .drop-badge {
            background: #ff2eff;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: inline-block;
        }

        .countdown-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .countdown-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 16px;
        }

        .countdown-timer {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            color: #f8ff00;
            margin-bottom: 20px;
        }

        .countdown-cta {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .cta-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cta-primary {
            background: #f8ff00;
            color: #111;
        }

        .cta-secondary {
            background: transparent;
            color: white;
            border: 1px solid white;
        }

        .cta-btn:hover {
            transform: translateY(-1px);
        }

        /* TICKER BAR */
        .ticker-container {
            background: #f8ff00;
            color: #111;
            height: 40px;
            overflow: hidden;
            position: relative;
        }

        .ticker-content {
            display: flex;
            align-items: center;
            height: 100%;
            animation: scroll 20s linear infinite;
            white-space: nowrap;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
        }

        .ticker-item {
            margin-right: 48px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* ABOUT THE DROP */
        .about-drop {
            background: linear-gradient(135deg, #111 0%, #1a1a1a 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .about-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .about-badge {
            background: #ff2eff;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 16px;
            display: inline-block;
        }

        .about-drop h2 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #f8ff00;
            letter-spacing: -1px;
        }

        .about-drop p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 16px;
            opacity: 0.9;
        }

        .collective-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #f8ff00;
            line-height: 1;
        }

        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* PARTICIPATION STEPS */
        .participation-steps {
            padding: 60px 20px;
            background: #f7f5f0;
        }

        .steps-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .participation-steps h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 40px;
            color: #111;
            letter-spacing: -0.5px;
        }

        .step-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .step-card {
            background: white;
            padding: 30px 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
            transition: all 0.3s ease;
        }

        .step-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .step-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff2eff, #ff008c);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            margin: 0 auto 16px;
        }

        .step-card h4 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #111;
        }

        .step-card p {
            font-size: 14px;
            line-height: 1.5;
            color: #666;
            margin-bottom: 16px;
        }

        .step-visual {
            font-size: 24px;
            opacity: 0.7;
        }

        .main-cta {
            margin-top: 40px;
        }

        .submit-story-btn {
            background: linear-gradient(135deg, #111 0%, #333 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-block;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .submit-story-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .btn-question {
            display: block;
            font-size: 16px;
            margin-bottom: 8px;
            color: #f8ff00;
            font-weight: 500;
        }

        .btn-action {
            display: block;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* U INSPIRE WALL */
        .wall-container {
            padding: 40px 20px;
            position: relative;
            min-height: 600px;
            overflow: hidden;
        }

        .wall-svg {
            width: 100%;
            height: 600px;
            position: relative;
        }

        .thread-text {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            font-family: 'Koulen', sans-serif;
            line-height: 1.1;
            cursor: pointer;
            transition: all 0.2s;
            position: absolute;
        }

        .thread-text:hover {
            transform: rotate(180deg) scale(1.05);
            z-index: 10;
        }

        /* THIS HIT HARD SECTION */
        .hit-hard-section {
            background: #111;
            color: white;
            padding: 40px 20px;
        }

        .hit-hard-title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 32px;
            color: #f8ff00;
        }

        .hit-hard-subtitle {
            text-align: center;
            font-size: 16px;
            margin-bottom: 40px;
            opacity: 0.8;
        }

        /* STORY CARDS (TikTok/IG Style) */
        .story-cards {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 0 20px 40px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }

        .story-card {
            min-width: 280px;
            height: 400px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            color: white;
            position: relative;
            scroll-snap-align: start;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .story-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }

        .story-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .thread-badge {
            background: rgba(248, 255, 0, 0.15);
            color: #f8ff00;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .emotion-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .story-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px 0;
        }

        .story-text {
            font-size: 18px;
            line-height: 1.4;
            font-weight: 500;
            font-style: italic;
        }

        .story-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .story-reactions {
            display: flex;
            gap: 16px;
        }

        .reaction {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            opacity: 0.9;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reaction:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .story-time {
            font-size: 12px;
            opacity: 0.6;
            font-weight: 500;
        }

        .capsule-preview {
            text-align: center;
            padding: 40px 20px 0;
        }

        .capsule-text {
            font-size: 16px;
            margin-bottom: 24px;
            opacity: 0.8;
        }

        .notify-btn {
            background: linear-gradient(135deg, #f8ff00 0%, #b8ff10 100%);
            color: #111;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(248, 255, 0, 0.3);
        }

        .notify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(248, 255, 0, 0.4);
        }

        /* SUBMISSION MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h3 {
            font-size: 24px;
            margin-bottom: 8px;
            color: #111;
        }

        .modal-header p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #111;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #ff2eff;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .emotion-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .emotion-option {
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .emotion-option:hover {
            border-color: #ff2eff;
        }

        .emotion-option.selected {
            border-color: #ff2eff;
            background: #ff2eff;
            color: white;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #111 0%, #333 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        /* MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            .countdown-cta {
                flex-direction: column;
                align-items: center;
            }
            
            .cta-btn {
                width: 200px;
            }

            .wall-svg {
                height: 500px;
            }

            .ticker-content {
                font-size: 12px;
            }

            .collective-stats {
                gap: 20px;
            }

            .step-cards {
                grid-template-columns: 1fr;
            }

            .about-drop h2 {
                font-size: 24px;
            }

            .participation-steps h3 {
                font-size: 22px;
            }

            .modal-content {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- DROP COUNTDOWN SECTION -->
    <section class="countdown-section">
        <div class="drop-badge">DROP #003 • BREAKING THE CYCLE</div>
        <h1 class="countdown-title">U INSPIRE WALL</h1>
        <p class="countdown-subtitle">Anonymous stories become wearable art</p>
        <div class="countdown-timer" id="countdown">02:14:37:22</div>
        <div class="countdown-cta">
            <button class="cta-btn cta-primary" onclick="openSubmissionModal()">SUBMIT YOUR THREAD</button>
            <a href="#" class="cta-btn cta-secondary">SHOP CAPSULE</a>
        </div>
    </section>

    <!-- TICKER BAR -->
    <div class="ticker-container">
        <div class="ticker-content" id="ticker">
            <div class="ticker-item">🔥 Drop closes in 2d 14h</div>
            <div class="ticker-item">❤️ Top thread: "I stopped pretending to be okay"</div>
            <div class="ticker-item">✨ <span id="submission-count">127</span>/150 submissions received</div>
            <div class="ticker-item">😭 68% of threads are about healing</div>
            <div class="ticker-item">🔥 Most reactions: "Finally said it out loud"</div>
            <div class="ticker-item">❤️ Community strength: GROWING DAILY</div>
        </div>
    </div>

    <!-- ABOUT THE DROP -->
    <section class="about-drop">
        <div class="about-container">
            <div class="about-badge">ABOUT THIS DROP</div>
            <h2>BREAKING THE CYCLE</h2>
            <p>We're collecting the moments when everything changed. The day you stopped running. The choice that saved you. The truth you finally spoke out loud.</p>
            <p><strong>This isn't therapy. This isn't advice. This is raw, unfiltered truth becoming art.</strong></p>
            
            <div class="collective-stats">
                <div class="stat">
                    <div class="stat-number" id="stories-count">127</div>
                    <div class="stat-label">stories shared</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="spots-left">23</div>
                    <div class="stat-label">spots left</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="days-remaining">3</div>
                    <div class="stat-label">days remaining</div>
                </div>
            </div>
        </div>
    </section>

    <!-- HOW TO PARTICIPATE -->
    <section class="participation-steps">
        <div class="steps-container">
            <h3>BE PART OF THE COLLECTIVE</h3>
            
            <div class="step-cards">
                <div class="step-card">
                    <div class="step-icon">01</div>
                    <h4>SHARE</h4>
                    <p>Submit your anonymous story and get your thread number</p>
                    <div class="step-visual">📝</div>
                </div>
                
                <div class="step-card">
                    <div class="step-icon">02</div>
                    <h4>ENGAGE</h4>
                    <p>React to others' stories. Feel less alone in your experience</p>
                    <div class="step-visual">❤️</div>
                </div>
                
                <div class="step-card">
                    <div class="step-icon">03</div>
                    <h4>CONNECT</h4>
                    <p>Get notified when the capsule drops with your collective stories</p>
                    <div class="step-visual">👕</div>
                </div>
            </div>
            
            <div class="main-cta">
                <button class="submit-story-btn" onclick="openSubmissionModal()">
                    <span class="btn-question">What's your breaking the cycle moment?</span>
                    <span class="btn-action">SHARE YOUR EXPERIENCE →</span>
                </button>
            </div>
        </div>
    </section>

    <!-- U INSPIRE WALL -->
    <section class="wall-container">
        <svg class="wall-svg" viewBox="0 0 400 600" id="inspireSvg">
            <!-- SVG content will be populated by JavaScript -->
        </svg>
    </section>

    <!-- THIS HIT HARD SECTION -->
    <section class="hit-hard-section">
        <h2 class="hit-hard-title">THIS HIT HARD</h2>
        <p class="hit-hard-subtitle">Stories that stopped us scrolling. Featured in next month's capsule.</p>
        
        <!-- Story Cards (TikTok/IG Style) -->
        <div class="story-cards" id="featured-stories">
            <!-- Stories will be populated by JavaScript -->
        </div>
        
        <div class="capsule-preview">
            <div class="capsule-text">These stories will be featured on limited capsule pieces</div>
            <button class="notify-btn" onclick="signupForNotifications()">GET NOTIFIED WHEN CAPSULE DROPS</button>
        </div>
    </section>

    <!-- SUBMISSION MODAL -->
    <div class="modal-overlay" id="submissionModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeSubmissionModal()">&times;</button>
            <div class="modal-header">
                <h3>Share Your Breaking the Cycle Moment</h3>
                <p>Anonymous • Thread #<span id="next-thread-number">128</span></p>
            </div>
            
            <form id="submissionForm">
                <div class="form-group">
                    <label class="form-label">Your Story *</label>
                    <textarea class="form-input form-textarea" name="message" placeholder="The moment everything changed..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Emotion</label>
                    <div class="emotion-selector">
                        <div class="emotion-option" data-emotion="love" data-color="#ff2eff">Love</div>
                        <div class="emotion-option" data-emotion="grief" data-color="#8a8a8a">Grief</div>
                        <div class="emotion-option" data-emotion="rage" data-color="#ff360a">Rage</div>
                        <div class="emotion-option" data-emotion="relief" data-color="#00ffe0">Relief</div>
                        <div class="emotion-option" data-emotion="shame" data-color="#d4d4d4">Shame</div>
                        <div class="emotion-option" data-emotion="joy" data-color="#fffb00">Joy</div>
                        <div class="emotion-option" data-emotion="fear" data-color="#a6a6a6">Fear</div>
                        <div class="emotion-option" data-emotion="calm" data-color="#c8b8a6">Calm</div>
                        <div class="emotion-option" data-emotion="empowerment" data-color="#ff008c">Empowerment</div>
                        <div class="emotion-option" data-emotion="hope" data-color="#b8ff10">Hope</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email (for capsule notifications)</label>
                    <input type="email" class="form-input" name="email" placeholder="your@email.com">
                </div>
                
                <button type="submit" class="submit-btn">SUBMIT YOUR THREAD</button>
            </form>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const AIRTABLE_BASE_ID = 'YOUR_BASE_ID'; // Replace with your Airtable base ID
        const AIRTABLE_TABLE_NAME = 'threads'; // Your table name
        const AIRTABLE_API_KEY = 'YOUR_API_KEY'; // Replace with your Airtable API key
        
        // EMOTION COLOR MAP
        const EMOTION_COLORS = {
            love: '#ff2eff',
            grief: '#8a8a8a',
            rage: '#ff360a',
            relief: '#00ffe0',
            shame: '#d4d4d4',
            joy: '#fffb00',
            fear: '#a6a6a6',
            calm: '#c8b8a6',
            empowerment: '#ff008c',
            hope: '#b8ff10'
        };

        // GLOBAL VARIABLES
        let threads = [];
        let selectedEmotion = null;

        // MODAL FUNCTIONS
        function openSubmissionModal() {
            document.getElementById('submissionModal').style.display = 'flex';
        }

        function closeSubmissionModal() {
            document.getElementById('submissionModal').style.display = 'none';
        }

        // EMOTION SELECTION
        document.querySelectorAll('.emotion-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.emotion-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedEmotion = this.dataset.emotion;
            });
        });

        // FORM SUBMISSION
        document.getElementById('submissionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const submission = {
                message: formData.get('message'),
                emotion: selectedEmotion || 'hope',
                email: formData.get('email'),
                status: 'Pending',
                drop_id: 'drop_003',
                reactions: {
                    heart: 0,
                    fire: 0,
                    sparkles: 0,
                    sad: 0,
                    rage: 0
                },
                created_at: new Date().toISOString()
            };

            try {
                await submitToAirtable(submission);
                closeSubmissionModal();
                alert('Your thread has been submitted! You\'ll receive your thread number via email.');
                e.target.reset();
                selectedEmotion = null;
                document.querySelectorAll('.emotion-option').forEach(opt => opt.classList.remove('selected'));
            } catch (error) {
                alert('Error submitting your thread. Please try again.');
                console.error('Submission error:', error);
            }
        });

        // AIRTABLE INTEGRATION
        async function submitToAirtable(data) {
            const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    fields: data
                })
            });

            if (!response.ok) {
                throw new Error('Failed to submit to Airtable');
            }

            return response.json();
        }

        async function loadThreadsFromAirtable() {
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?filterByFormula=AND({status}='Accepted',{drop_id}='drop_003')`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                    }
                });

                const data = await response.json();
                threads = data.records.map(record => ({
                    id: record.id,
                    ...record.fields
                }));

                renderWall();
                renderFeaturedStories();
                updateStats();
            } catch (error) {
                console.error('Error loading threads:', error);
            }
        }

        // WALL RENDERING
        function renderWall() {
            const svg = document.getElementById('inspireSvg');
            
            // Create clip path and render threads
            svg.innerHTML = `
                <defs>
                    <clipPath id="uInspireClip">
                        <path d="M40 50 L40 180 Q40 220 80 220 Q120 220 120 180 L120 50 L100 50 L100 180 Q100 200 80 200 Q60 200 60 180 L60 50 Z"/>
                        <rect x="160" y="50" width="20" height="170"/>
                        <path d="M40 280 L40 450 L60 450 L60 320 L100 450 L120 450 L120 280 L100 280 L100 410 L60 280 Z"/>
                        <path d="M160 280 Q140 280 140 300 Q140 320 160 320 L180 320 Q200 320 200 340 Q200 360 180 360 L140 360 L140 380 L180 380 Q220 380 220 340 Q220 300 180 300 L160 300 Q140 300 140 280 Q140 260 160 260 L200 260 L200 240 L160 240 Q120 240 120 280 Z"/>
                        <path d="M240 280 L240 450 L260 450 L260 380 L280 380 Q320 380 320 340 Q320 300 280 300 L260 300 L260 280 Z M260 320 L280 320 Q300 320 300 340 Q300 360 280 360 L260 360 Z"/>
                        <rect x="340" y="280" width="20" height="170"/>
                        <path d="M60 500 L60 650 L80 650 L80 600 L100 600 L120 650 L140 650 L115 600 Q140 600 140 575 Q140 550 115 550 L80 550 L80 500 Z M80 520 L115 520 Q120 520 120 535 Q120 550 115 550 L80 550 Z"/>
                        <path d="M160 500 L160 650 L220 650 L220 630 L180 630 L180 590 L210 590 L210 570 L180 570 L180 520 L220 520 L220 500 Z"/>
                    </clipPath>
                </defs>
                <rect width="400" height="600" fill="#f7f5f0" clip-path="url(#uInspireClip)"/>
                <g clip-path="url(#uInspireClip)">
                    ${threads.slice(0, 150).map((thread, index) => {
                        const x = 50 + (index * 15) % 350;
                        const y = 80 + Math.floor(index / 23) * 40;
                        const fontSize = Math.min(14, Math.max(8, 8 + (thread.reactions?.heart || 0) * 0.5));
                        const color = EMOTION_COLORS[thread.emotion] || '#111';
                        
                        return `
                            <text x="${x}" y="${y}" 
                                  class="thread-text" 
                                  style="font-size: ${fontSize}px; fill: ${color};" 
                                  data-thread="${thread.id}"
                                  onclick="showThreadDetails('${thread.id}')">
                                <tspan>${thread.message.substring(0, 30)}${thread.message.length > 30 ? '...' : ''}</tspan>
                            </text>
                        `;
                    }).join('')}
                </g>
            `;
        }

        // FEATURED STORIES RENDERING
        function renderFeaturedStories() {
            const container = document.getElementById('featured-stories');
            const featured = threads
                .filter(thread => thread.capsule_feature)
                .sort((a, b) => (b.reactions?.heart || 0) - (a.reactions?.heart || 0))
                .slice(0, 5);

            container.innerHTML = featured.map((thread, index) => `
                <div class="story-card">
                    <div class="story-header">
                        <div class="thread-badge">#${String(index + 1).padStart(3, '0')}</div>
                        <div class="emotion-dot" style="background-color: ${EMOTION_COLORS[thread.emotion]};"></div>
                    </div>
                    <div class="story-content">
                        <div class="story-text">"${thread.message}"</div>
                    </div>
                    <div class="story-footer">
                        <div class="story-reactions">
                            <div class="reaction" onclick="reactToThread('${thread.id}', 'heart')">❤️ ${thread.reactions?.heart || 0}</div>
                            <div class="reaction" onclick="reactToThread('${thread.id}', 'fire')">🔥 ${thread.reactions?.fire || 0}</div>
                            <div class="reaction" onclick="reactToThread('${thread.id}', 'sparkles')">✨ ${thread.reactions?.sparkles || 0}</div>
                        </div>
                        <div class="story-time">${getTimeAgo(thread.created_at)}</div>
                    </div>
                </div>
            `).join('');
        }

        // REACTION SYSTEM
        async function reactToThread(threadId, reactionType) {
            try {
                const thread = threads.find(t => t.id === threadId);
                if (!thread) return;

                const updatedReactions = {
                    ...thread.reactions,
                    [reactionType]: (thread.reactions[reactionType] || 0) + 1
                };

                await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}/${threadId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fields: {
                            reactions: updatedReactions
                        }
                    })
                });

                // Update local data and re-render
                thread.reactions = updatedReactions;
                renderFeaturedStories();
                renderWall();
            } catch (error) {
                console.error('Error updating reaction:', error);
            }
        }

        // UTILITY FUNCTIONS
        function getTimeAgo(dateString) {
            const now = new Date();
            const created = new Date(dateString);
            const diffInHours = Math.floor((now - created) / (1000 * 60 * 60));
            
            if (diffInHours < 1) return 'Just now';
            if (diffInHours < 24) return `${diffInHours}h ago`;
            return `${Math.floor(diffInHours / 24)}d ago`;
        }

        function updateStats() {
            document.getElementById('stories-count').textContent = threads.length;
            document.getElementById('spots-left').textContent = Math.max(0, 150 - threads.length);
            document.getElementById('submission-count').textContent = threads.length;
        }

        function signupForNotifications() {
            const email = prompt('Enter your email for capsule drop notifications:');
            if (email && email.includes('@')) {
                // In production, send this to your email service
                alert('Thanks! You\'ll be notified when the capsule drops.');
            }
        }

        function showThreadDetails(threadId) {
            const thread = threads.find(t => t.id === threadId);
            if (thread) {
                alert(`Thread #${threadId.slice(-3)}\n\n"${thread.message}"\n\nEmotion: ${thread.emotion}\nReactions: ❤️ ${thread.reactions?.heart || 0} 🔥 ${thread.reactions?.fire || 0}`);
            }
        }

        // COUNTDOWN TIMER
        function updateCountdown() {
            const dropEndDate = new Date('2025-05-26T23:59:59');
            const now = new Date();
            const timeLeft = dropEndDate - now;

            if (timeLeft > 0) {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                document.getElementById('countdown').textContent = 
                    `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                document.getElementById('countdown').textContent = 'DROP CLOSED';
            }
        }

        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            loadThreadsFromAirtable();
            
            // Start countdown timer
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            // Close modal when clicking outside
            document.getElementById('submissionModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSubmissionModal();
                }
            });
        });

        // PERIODIC DATA REFRESH
        setInterval(loadThreadsFromAirtable, 30000); // Refresh every 30 seconds
    </script>
</body>
</html>